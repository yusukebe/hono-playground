<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css"
    />
    <link rel="stylesheet" data-name="vs/editor/editor.main" href="/vs/editor/editor.main.css" />
    <link rel="stylesheet" href="/style.css" />
    <script>
      var require = { paths: { vs: '/vs' } }
    </script>
    <script src="/vs/loader.js"></script>
    <script src="/vs/editor/editor.main.nls.js"></script>
    <script src="/vs/editor/editor.main.js"></script>
    <script type="module">
      import Alpine from 'https://esm.sh/alpinejs'

      Alpine.store('app', {
        init() {
          this.dispatch()
          this.createMonaco()
        },
        createMonaco() {
          const editor = monaco.editor.create(document.getElementById('editor'), {
            value: [this.code].join('\n'),
            language: 'javascript',
            minimap: { enabled: false },
          })
          editor.getModel().onDidChangeContent((event) => {
            this.code = editor.getValue()
            this.dispatch()
          })
        },
        async dispatch() {
          const code = this.code
          try {
            const blobURL = URL.createObjectURL(new Blob([code], { type: 'text/javascript' }))
            const { default: app } = await import(/*@vite-ignore */ blobURL)

            const res = await app.request(this.path, {
              method: this.method,
            })
            this.info.status = res.status
            this.info.headers = [...res.headers.entries()]
              .reduce((acc, [key, value]) => {
                return acc + `${key}: ${value}, `
              }, '')
              .slice(0, -2)
            this.result = await res.text()
          } catch (e) {
            console.log(`${e}`)
          }
        },
        code: `import { Hono } from 'https://esm.sh/hono'

const app = new Hono()

app.get('/hello', (c) => {
  const name = c.req.query('name')
  return c.text(\`Hello \${name}\!\`)
})

export default app`,
        method: 'get',
        path: '/hello?name=Hono',
        result: 'loading...',
        info: {
          status: undefined,
          headers: '',
        },
      })
      window.Alpine = Alpine
      window.Alpine.start()
    </script>
    <title>Hono Playground</title>
  </head>
  <body>
    <header>Hono on your browser.</header>
    <main x-data>
      <div id="editor"></div>
      <div id="browser">
        <form @submit.prevent="$store.app.dispatch()">
          <select x-model="$store.app.method">
            <option value="get">GET</option>
            <option value="post">POST</option>
            <option value="put">PUT</option>
            <option value="delete">DELETE</option>
          </select>
          <input type="text" x-model="$store.app.path" autocomplete="off" />
          <button>Send</button>
        </form>
        <div id="result">
          <div>
            <small x-text="$store.app.info.status"></small><br />
            <small x-text="$store.app.info.headers"></small>
          </div>
          <hr />
          <div x-text="$store.app.result"></div>
        </div>
      </div>
    </main>
    <footer>
      Powered by <a href="https://hono.dev">Hono</a>,
      <a href="https://github.com/yusukebe/hono-playground/blob/main/index.html">the code</a>.
    </footer>
  </body>
</html>
